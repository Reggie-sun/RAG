<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>原文摘录展开测试</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test-container {
            border: 1px solid #ccc;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }
        .excerpt-container {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 12px;
            background: white;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
            position: relative;
        }
        .max-h-40 { max-height: 160px; }
        .overflow-hidden { overflow: hidden; }
        .gradient-mask {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 56px;
            background: linear-gradient(to top, white, rgba(255,255,255,0.7));
            pointer-events: none;
        }
        button {
            border: 1px solid #007acc;
            background: white;
            color: #007acc;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            margin-top: 8px;
        }
        button:hover { background: #f0f8ff; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script>
        const { useState } = React;

        function OriginalExcerptTest() {
            const [expandedSections, setExpandedSections] = useState({});

            // 模拟数据
            const section = {
                anchorId: 'test-excerpt',
                title: '原文摘录（更多细节）',
                markdown: `这是第一行测试内容，用于验证展开功能。
这是第二行内容，应该默认显示出来。
这是第三行内容，用于测试展开效果。
这是第四行内容，验证修改是否生效。
这是第五行内容，测试长文本的显示。
这是第六行内容，确保所有内容都可见。
这是第七行内容，最后一行测试文本。`
            };

            const isOriginalExcerpt = true;

            const expanded = expandedSections[section.anchorId] ?? true; // 默认展开
            const shouldCollapse = Boolean(section.markdown);

            return (
                React.createElement('div', { className: 'test-container' },
                    React.createElement('h2', null, '原文摘录展开测试'),
                    React.createElement('p', null, `expanded 状态: ${expanded ? '展开' : '折叠'}`),

                    React.createElement('div', null,
                        React.createElement('h3', null, section.title),
                        React.createElement('div', null, '测试结果:'),
                        React.createElement('ul', null,
                            React.createElement('li', null, `expanded = ${expanded}`),
                            React.createElement('li', null, `shouldCollapse = ${shouldCollapse}`),
                            React.createElement('li', null, `默认展开状态: ${expanded ? '✅ 成功' : '❌ 失败'}`)
                        )
                    ),

                    React.createElement('div', {
                        className: `excerpt-container ${!expanded && shouldCollapse ? 'max-h-40 overflow-hidden' : ''}`,
                        style: { position: 'relative' }
                    },
                        React.createElement('div', null, section.markdown.split('\n').map((line, index) =>
                            React.createElement('div', { key: index }, line)
                        )),
                        !expanded && shouldCollapse &&
                            React.createElement('div', { className: 'gradient-mask' })
                    ),

                    shouldCollapse &&
                        React.createElement('button', {
                            onClick: () => setExpandedSections(prev => ({
                                ...prev,
                                [section.anchorId]: !expanded
                            }))
                        }, expanded ? '收起原文' : '展开更多')
                )
            );
        }

        ReactDOM.render(React.createElement(OriginalExcerptTest), document.getElementById('root'));
    </script>
</body>
</html>